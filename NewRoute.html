<!DOCTYPE html>
<html>
<head>
  <!-- Site made with Mobirise Website Builder v4.3.4, https://mobirise.com -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Mobirise v4.3.4, mobirise.com">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="assets/logo.png" type="image/x-icon">
  <meta name="description" content="Website Generator Description">
  <title>NewRoute</title>
  <link rel="stylesheet" href="assets/web/assets/mobirise-icons/mobirise-icons.css">
  <link rel="stylesheet" href="assets/tether/tether.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="assets/bootstrap/css/bootstrap-reboot.min.css">
  <link rel="stylesheet" href="assets/soundcloud-plugin/style.css">
  <link rel="stylesheet" href="assets/dropdown/css/style.css">
  <link rel="stylesheet" href="assets/theme/css/style.css">
  <link rel="stylesheet" href="assets/mobirise/css/mbr-additional.css" type="text/css">
  

</head>
<body>
<div id="newroute">
<section class="menu cid-qyjvLk1Tsr" once="menu" id="menu1-h" data-rv-view="2401">

    <nav class="navbar navbar-expand beta-menu navbar-dropdown align-items-center navbar-toggleable-sm">
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
        <div class="menu-logo">
            <div class="navbar-brand">
                <img src="assets/car.png" media-simple="true" style="height: 3rem;"> &nbsp;&nbsp;&nbsp;
                <span class="navbar-caption-wrap"><a class="navbar-caption text-white display-4" href="NewRoute.html">CarPooling</a></span>
            </div>
        </div>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav nav-dropdown" data-app-modern-menu="true">
                <li class="nav-item"><a class="nav-link link text-white display-7" href="NewRoute.html">NewRoute</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link link text-white dropdown-toggle display-7" href="RouteList.html?type=0" data-toggle="dropdown-submenu" aria-expanded="false">MyRoute</a>
                    <div class="dropdown-menu">
                        <a class="text-white dropdown-item display-7" href="RouteList.html?type=0">All Routes</a>
                        <a class="text-white dropdown-item display-7" href="RouteList.html?type=1">Successful</a>
                        <a class="text-white dropdown-item display-7" href="RouteList.html?type=2">Bidding</a>
                        <a class="text-white dropdown-item display-7" href="RouteList.html?type=3">Failed</a>
                        <a class="text-white dropdown-item display-7" href="RouteList.html?type=4">Finished</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link link text-white dropdown-toggle display-7" href="Account.html" data-toggle="dropdown-submenu" aria-expanded="false">Account</a>
                    <div class="dropdown-menu">
                        <a class="text-white dropdown-item display-7" href="Password.html">Password Changing</a>
                        <a class="text-white dropdown-item display-7" href="MyCar.html" aria-expanded="false">Car Management</a>
                        <a class="text-white dropdown-item display-7" href="Account.html" aria-expanded="false">Personal Imformation</a>
                    </div>
                </li>
                <li class="nav-item dropdown open">
                    <a class="nav-link link text-white dropdown-toggle display-7" href="Home.html" aria-expanded="true" data-toggle="dropdown-submenu">Logout</a>
                    <div class="dropdown-menu">
                        <a class="text-white dropdown-item display-7" v-on:click="logout" aria-expanded="true">Logout</a>
                        <a class="text-white dropdown-item display-7" v-on:click="toBePassenger" aria-expanded="false">To Be A Passenger</a>
                    </div>
                </li>
            </ul>
            <div class="navbar-buttons mbr-section-btn"><a class="btn btn-sm btn-white display-7" href="JoinUs.html">Join Us</a></div>
        </div>
    </nav>
</section>

<section class="mbr-section form4 cid-qymT1GjGBJ" id="form4-1b" data-rv-view="2440">

    

    
    <div class="container" style="margin-top: 60px">
        <div class="row">
            <div class="col-md-6">
                <div class="google-map"><iframe frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?key=AIzaSyA0Dx_boXQiwvdz8sJHoYeZNVTdoWONYkU&amp;q=place_id:ChIJn6wOs6lZwokRLKy1iqRcoKw" allowfullscreen=""></iframe></div>
            </div>
            <div class="col-md-6">
                <h2 class="pb-3 align-left mbr-fonts-style display-2">New Route</h2>
                <div data-form-type="formoid">
                    <p class="mbr-text mbr-fonts-style">{{info}}</p>
                    <form class="block mbr-form" method="post" data-form-title="release">
                        <div class="row">
                            <div class="col-md-12 multi-horizontal" data-for="origin">
                                <input type="text" class="form-control input" ref="origin" data-form-field="origin" placeholder="Origin" required id="origin-release">
                            </div>
                            <div class="col-md-12 multi-horizontal" data-for="destination">
                                <input type="text" class="form-control input" ref="destination" data-form-field="destination" placeholder="Destination" required id="destination-release">
                            </div>
                            <div class="col-md-6" data-for="date">
                                <input type="text" class="form-control input" ref="date" data-form-field="date" placeholder="Date (e.g. 2017-10-02)" required id="date-release">
                            </div>
                            <div class="col-md-6" data-for="time">
                                <input type="text" class="form-control input" ref="time" data-form-field="time" placeholder="Time (e.g. 15:30)" required id="time-release">
                            </div>
                            <div class="col-md-6" data-for="price">
                                <input type="text" class="form-control input" ref="price" data-form-field="price" placeholder="Price" required id="price-release">
                            </div>
                            <div class="col-md-6" data-for="car">
                                <select ref="car" class="form-control input" data-form-field="car" required id="car-release" style="height: 58.22px">
                                    <option v-for="car in cars">{{car.number}}</option>
                                </select>
                            </div>
                            <div class="input-group-btn col-md-12" style="margin-top: 10px;">
                                <button v-on:click="newRoute" type="submit" class="btn btn-form btn-black display-4">NEW ROUTE</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<section once="" class="cid-qynYoRp62x" id="footer6-2m" data-rv-view="2406">

    <div class="container">
        <div class="media-container-row align-center mbr-white">
            <div class="col-12">
                <p class="mbr-text mb-0 mbr-fonts-style display-7">
                    Â© Copyright 2017 CarPooling - All Rights Reserved
                </p>
            </div>
        </div>
    </div>
</section>

</div>



  <script src="assets/web/assets/jquery/jquery.min.js"></script>
  <script src="assets/popper/popper.min.js"></script>
  <script src="assets/tether/tether.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script src="assets/dropdown/js/script.min.js"></script>
  <script src="assets/touch-swipe/jquery.touch-swipe.min.js"></script>
  <script src="assets/smooth-scroll/smooth-scroll.js"></script>
  <script src="assets/theme/js/script.js"></script>
  <script src="assets/formoid/formoid.min.js"></script>
  <script src="assets/vue.min.js"></script>
  <script src="assets/util.js"></script>
  
  
</body>
</html>

<script>
    var app = new Vue({
        el: '#newroute',
        data: {
            info: '',
            cars: []
        },
        created () {
            vm = this;
            if (getCookie("email") === null) {
                window.location.href = 'Login.html';
                return;
            }
            datas = {
                email: getCookie("email")
            };
            $.ajax({
                url: "PHP/MyCar.php",
                type: "POST",
                data: datas,
                dataType: "JSON",
                success: function (result) {
                    if (result['total'] === 0) {
                        window.location.href = 'NewCar.html';
                    } else {
                        vm.cars = result['result']
                    }
                },
                error: function (result) {
                    window.location.href = 'NewCar.html';
                }
            })
        },
        methods: {
            logout: function (event) {
                delCookie("email");
                delCookie("identity");
                window.location.href="Home.html"
            },
            toBePassenger: function(event) {
                setCookie("identity", "passenger", 30);
                window.location.href = 'Explore.html';
            },
            newRoute: function (event) {
                vm = this;
                if (vm.$refs.origin.value === '' || vm.$refs.destination.value === '' || vm.$refs.date.value === ''
                    || vm.$refs.time.value === '' || vm.$refs.price.value === '' || vm.$refs.car.value === '') {
                    vm.info = 'Empty Value';
                    return
                }
                re = /^\d+(\.\d{1,2})?$/;
                if (!re.test(vm.$refs.price.value)) {
                    vm.info = 'Enter Correct Price';
                    return
                }
                re = /^((([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8]))))|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))-02-29))$/;
                if (!re.test(vm.$refs.date.value)) {
                    vm.info = 'Enter Correct Date';
                    return
                }
                re = /^(20|21|22|23|[0-1]\d):[0-5]\d(:[0-5]\d)?$/;
                if (!re.test(vm.$refs.time.value)) {
                    vm.info = 'Enter Correct time';
                    return
                }
                datas = {
                    driver: getCookie("email"),
                    origin: vm.$refs.origin.value,
                    destination: vm.$refs.destination.value,
                    date: vm.$refs.date.value,
                    time: vm.$refs.time.value,
                    price: vm.$refs.price.value,
                    car: vm.$refs.car.value
                };
                $.ajax({
                    url: "PHP/AddRoute.php",
                    type: "POST",
                    data: datas,
                    dataType: "JSON",
                    success: function (result) {
                        if (result['errno'] === 1) {
                            vm.info = 'Route Exist'
                        } else if (result['errno'] === 2) {
                            vm.info = 'Conflict :('
                        } else if (result['errno'] === 3) {
                            vm.info = 'Enter Correct Date And Time'
                        } else {
                            window.location.href = 'RouteList.html';
                        }
                    },
                    error: function (result) {
                        vm.info = 'Fail :( Try Again'
                    }
                })
            },

        }
    })
</script>